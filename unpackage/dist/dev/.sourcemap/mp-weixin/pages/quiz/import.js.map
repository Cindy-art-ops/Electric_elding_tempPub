{"version":3,"file":"import.js","sources":["pages/quiz/import.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcXVpei9pbXBvcnQudnVl"],"sourcesContent":["<template>\r\n  <scroll-view class=\"page\" scroll-y>\r\n    <view class=\"tip\"\r\n      >支持粘贴四种题型的文本模版，解析成功后会暂存到本地（仅前端）。</view\r\n    >\r\n\r\n    <view class=\"tabs\">\r\n      <view\r\n        v-for=\"t in tabs\"\r\n        :key=\"t.key\"\r\n        class=\"tab\"\r\n        :class=\"{ active: t.key === cur }\"\r\n        @tap=\"cur = t.key\"\r\n        >{{ t.name }}</view\r\n      >\r\n    </view>\r\n\r\n    <textarea class=\"editor\" v-model=\"raw\" :placeholder=\"placeholder\" />\r\n    <view class=\"btns\">\r\n      <button class=\"btn-outline\" @tap=\"fillSample\">填入示例</button>\r\n      <button class=\"btn-primary\" @tap=\"parseNow\">解析保存</button>\r\n    </view>\r\n\r\n    <view v-if=\"err\" class=\"err\">{{ err }}</view>\r\n    <view v-if=\"preview.length\" class=\"preview\">\r\n      <view class=\"pre-title\">解析预览（{{ preview.length }} 道）</view>\r\n      <view class=\"card\" v-for=\"(q, i) in preview\" :key=\"i\">\r\n        <text class=\"q\">{{ i + 1 }}. {{ q.title }}</text>\r\n        <view v-if=\"q.options\">\r\n          <text v-for=\"(op, oi) in q.options\" :key=\"oi\"\r\n            >{{ String.fromCharCode(65 + oi) }}. {{ op }}</text\r\n          >\r\n        </view>\r\n        <text class=\"a\"\r\n          >答案：{{\r\n            Array.isArray(q.answer) ? q.answer.join(\",\") : q.answer\r\n          }}</text\r\n        >\r\n      </view>\r\n    </view>\r\n  </scroll-view>\r\n</template>\r\n\r\n<script>\r\nconst KEY = \"quiz_import_bank\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      tabs: [\r\n        { key: \"single\", name: \"单选题\" },\r\n        { key: \"multi\", name: \"多选题\" },\r\n        { key: \"judge\", name: \"判断题\" },\r\n        { key: \"blank\", name: \"填空题\" },\r\n      ],\r\n      cur: \"single\",\r\n      raw: \"\",\r\n      err: \"\",\r\n      preview: [],\r\n    };\r\n  },\r\n  computed: {\r\n    placeholder() {\r\n      switch (this.cur) {\r\n        case \"single\":\r\n          return \"格式：\\n题干\\nA. 选项1\\nB. 选项2\\nC. 选项3\\nD. 选项4\\n答案：A\\n---\\n下一题...\";\r\n        case \"multi\":\r\n          return \"格式：\\n题干\\nA. 选项1\\nB. 选项2\\nC. 选项3\\nD. 选项4\\n答案：A,B\\n---\\n下一题...\";\r\n        case \"judge\":\r\n          return \"格式：\\n题干\\n答案：对/错\\n---\\n下一题...\";\r\n        case \"blank\":\r\n          return \"格式：\\n题干（用【】表示空格）\\n答案：填空1|填空2（多空用|分隔）\\n---\\n下一题...\";\r\n      }\r\n      return \"\";\r\n    },\r\n  },\r\n  methods: {\r\n    fillSample() {\r\n      const samples = {\r\n        single: `焊接电弧的热源主要来源于？\\nA. 电能\\nB. 机械能\\nC. 化学能\\nD. 核能\\n答案：A\\n---\\n焊条药皮的主要作用是？\\nA. 形成保护气体\\nB. 增加焊缝强度\\nC. 降低电压\\nD. 提高电流\\n答案：A`,\r\n        multi: `关于焊接安全，下列说法正确的是？\\nA. 焊接时应佩戴护目镜\\nB. 工作场所要有良好通风\\nC. 可以用湿手触摸焊机\\nD. 需要穿戴防护手套\\n答案：A,B,D`,\r\n        judge: `焊接过程中产生的紫外线对人体无害。\\n答案：错\\n---\\nCO2气体保护焊常用作低碳钢的焊接。\\n答案：对`,\r\n        blank: `焊接接头通常由【焊缝】和【热影响区】组成。\\n答案：焊缝|热影响区`,\r\n      };\r\n      this.raw = samples[this.cur];\r\n    },\r\n    parseNow() {\r\n      this.err = \"\";\r\n      try {\r\n        const res = this.parseText(this.cur, this.raw);\r\n        this.preview = res;\r\n        // 按章节维度可扩展，这里简化存储\r\n        const pack = { type: this.cur, list: res, ts: Date.now() };\r\n        uni.setStorageSync(KEY, pack);\r\n        // 额外按题型单独存储，便于“章节自测”汇总展示\r\n        uni.setStorageSync(`quiz_bank_${this.cur}`, pack);\r\n        uni.showToast({ title: \"解析成功\", icon: \"success\" });\r\n      } catch (e) {\r\n        this.err = String(e.message || e);\r\n      }\r\n    },\r\n    parseText(type, text) {\r\n      if (!text || !text.trim()) throw new Error(\"请输入题目文本\");\r\n      const blocks = text.split(/\\n---\\n/);\r\n      const list = [];\r\n      for (const b of blocks) {\r\n        const lines = b\r\n          .split(/\\n/)\r\n          .map((s) => s.trim())\r\n          .filter(Boolean);\r\n        if (lines.length < 2) continue;\r\n        const title = lines[0];\r\n        const ansLine = lines.find((l) => /^答案：/i.test(l));\r\n        if (!ansLine) throw new Error(\"缺少“答案：”行\");\r\n        const answerRaw = ansLine.replace(/^答案：/i, \"\").trim();\r\n\r\n        if (type === \"single\" || type === \"multi\") {\r\n          const opts = lines\r\n            .slice(1)\r\n            .filter((l) => /^[A-D][\\.|、]/.test(l))\r\n            .map((l) => l.replace(/^[A-D][\\.|、]\\s*/, \"\"));\r\n          if (opts.length < 2) throw new Error(\"选项不足\");\r\n          let answer = answerRaw\r\n            .split(/[,，]/)\r\n            .map((s) => s.trim())\r\n            .filter(Boolean);\r\n          if (type === \"single\" && answer.length !== 1)\r\n            throw new Error(\"单选题答案只能有1个\");\r\n          // 转换成索引或字母均可，这里保留字母\r\n          list.push({ type, title, options: opts, answer });\r\n        } else if (type === \"judge\") {\r\n          const answer = /^(对|错|正确|错误)$/i.test(answerRaw)\r\n            ? /(对|正确)/i.test(answerRaw)\r\n              ? \"对\"\r\n              : \"错\"\r\n            : null;\r\n          if (!answer) throw new Error(\"判断题答案仅支持 对/错/正确/错误\");\r\n          list.push({ type, title, answer });\r\n        } else if (type === \"blank\") {\r\n          const answer = answerRaw\r\n            .split(\"|\")\r\n            .map((s) => s.trim())\r\n            .filter(Boolean);\r\n          if (!answer.length) throw new Error(\"填空题至少一个答案\");\r\n          list.push({\r\n            type,\r\n            title,\r\n            blanks: (title.match(/【.+?】/g) || []).length || answer.length,\r\n            answer,\r\n          });\r\n        }\r\n      }\r\n      if (!list.length) throw new Error(\"未解析到题目\");\r\n      return list;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n$primary: #d32f2f;\r\n.page {\r\n  padding: 24rpx;\r\n}\r\n.tip {\r\n  color: #666;\r\n  font-size: 24rpx;\r\n  margin-bottom: 12rpx;\r\n}\r\n.tabs {\r\n  display: flex;\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  overflow: hidden;\r\n  margin-bottom: 12rpx;\r\n}\r\n.tab {\r\n  flex: 1;\r\n  text-align: center;\r\n  padding: 16rpx;\r\n  color: #666;\r\n}\r\n.tab.active {\r\n  color: #fff;\r\n  background: $primary;\r\n}\r\n.editor {\r\n  width: 100%;\r\n  height: 420rpx;\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 16rpx;\r\n  box-sizing: border-box;\r\n}\r\n.btns {\r\n  display: flex;\r\n  gap: 12rpx;\r\n  margin: 12rpx 0 6rpx;\r\n}\r\n.btn-primary {\r\n  background: $primary;\r\n  color: #fff;\r\n}\r\n.btn-outline {\r\n  color: $primary;\r\n  border: 2rpx solid $primary;\r\n  background: #fff;\r\n}\r\n.err {\r\n  color: #d32f2f;\r\n  margin: 8rpx 0;\r\n}\r\n.preview {\r\n  margin-top: 8rpx;\r\n}\r\n.pre-title {\r\n  font-weight: 600;\r\n  margin-bottom: 8rpx;\r\n}\r\n.card {\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 16rpx;\r\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.06);\r\n}\r\n.card + .card {\r\n  margin-top: 12rpx;\r\n}\r\n.q {\r\n  display: block;\r\n  margin-bottom: 6rpx;\r\n}\r\n.a {\r\n  color: #333;\r\n  margin-top: 6rpx;\r\n  display: block;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'G:/HBuilderX.4.75/HBuilderProjects/孙震老师_电弧焊接/pages/quiz/import.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}